@model Mercadia.Web.ViewModels.Products.ProductsListViewModel
@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_CenterLayout.cshtml";
}

<header class="page-header">
    <h1 class="page-title">Products</h1>
    <h3 class="page-title">in @Model.Store category @Model.Category</h3>
</header>

<a href="~/manage/products/add/@Model.CategoryId"><button class="btn btn-action" type="button"><span class="fa fa-plus"></span></button></a>
<br /><br />

<table class="table table-striped table-hover table-res">
    <thead>
        <tr>
            <th>&nbsp;</th>
            <th>Sku</th>
            <th>Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Status</th>
            <th class="td-option">&nbsp;</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Products)
        {
            <tr>
                <td><p><img id="image_@item.Id" src="@item.ProfilePic" alt="@item.Name" style="width:25px;height:25px;" /></p></td>
                <td><p>@item.Sku</p></td>
                <td><p>@item.Name</p></td>
                <td><p>@item.Description</p></td>
                <td><p>@item.Price</p></td>
                <td><p>@item.Status</p></td>>
                <td class="td-option">
                    <div class="btn-group">
                        <a href="~/manage/products/update/@item.Id" title="edit"><span class="fa fa-pencil"></span></a>&nbsp;&nbsp;&nbsp;
                        <a href="#" title="change image" onclick="changePicPrompt('@item.Id','@item.ProfilePic')"><span class="fa fa-image"></span></a>&nbsp;&nbsp;&nbsp;
                        <a href="#" title="activate\publish" onclick="activate('@item.Id')" style="@((item.Status == Mercadia.Infrastructure.Enums.Status.Active ? "display:none" : ""))"><span class="fa fa-level-up"></span></a>&nbsp;&nbsp;&nbsp;
                        <a href="#" title="deactivate" onclick="deactivate('@item.Id')" style="@((item.Status == Mercadia.Infrastructure.Enums.Status.Active ? "" : "display:none"))"><span class="fa fa-level-down"></span></a>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>



@section scripts{
<div class="modal fade" id="mdlChangePic" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Change Image</h4>
            </div>
            @using (Html.BeginForm("ChangeProfilePic", "Products", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    <div class="col-lg-12">

                        <img src="" alt="Product Image" id="imagePreview" style="width:200px;height:200px;" />
                        <div class="row">
                            <input type="hidden" name="imageId" value="" />
                            <div class="top-margin">
                                <input type="file" name="File" class="col-sm-11" style="margin-left:10px;margin-right:10px;border: 1px solid #ccc;border-radius: 4px;height: 34px;padding: 6px 12px;font-size: 14px;" />
                            </div>
                        </div>

                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <input id="btnSaveNewImage" type="submit" class="btn btn-primary" value="Save" />
                </div>
            }

        </div>
    </div>
</div>


    <script>
        function changePicPrompt(itemId, imageSrc) {
            $('#imageId').val(itemId);
            $('#imagePreview').attr('src', imageSrc);
            $('#mdlChangePic').modal('show');
        }

        function activate(id) {
            var model = {
                Id: id,
                Status: 1,
                CategoryId: "@Model.CategoryId"
            }

            $.ajax({
                url: "@Url.Content("~/manage/products/changestatus")",
                dataType: "json",
                data: model,
                type: "POST",
                async: false
            }).done(function (obj) {
                location.reload();
            }).fail(function (obj) {
                location.reload();
            });

        }

        function deactivate(id) {
            var model = {
                Id: id,
                Status: 0,
                CategoryId: "@Model.CategoryId"
            }

            $.ajax({
                url: "@Url.Content("~/manage/products/changestatus")",
                dataType: "json",
                data: model,
                type: "POST",
                async: false
            }).done(function (obj) {
                location.reload();
            }).fail(function (obj) {
                location.reload();
            });

        }
    </script>
}